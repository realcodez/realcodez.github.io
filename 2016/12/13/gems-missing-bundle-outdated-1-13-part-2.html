<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Gems Missing from Bundle Outdated in 1.13, Part 2</title>
    <meta name="description" content="Where real world development meets real world failure and frustration for your entertainucation.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://realcodez.com/2016/12/13/gems-missing-bundle-outdated-1-13-part-2.html">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
          }, i[r].l = 1 * new Date();
        a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-10903595-3', 'auto');
      ga('send', 'pageview');

    </script>
</head>


  <body>

    <header class="site-header">

    <div class="wrapper">

        <a href="/">
            <img src="/img/logo.png"/>
        </a>

    </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Gems Missing from Bundle Outdated in 1.13, Part 2</h1>
    <p class="post-meta">Dec 13, 2016</p>
  </header>

  <article class="post-content">
    <p>Having set ourselves up to add some smaller scoped tests in 
<a href="/2016/11/23/gems-missing-bundle-outdated-1-13-part-1.html">Part 1</a> by refactoring the
contributor’s bug fix, it’s now time to write some tests in Part 2. Scroll to the 
bottom to jump into it.</p>

<p>Before diving in, we address a couple of points of “Olde Business”, in particular
a point about referring to something “stupid” I did in Part 1. Learning is not
“stupid” and so I offer up a correction of myself.</p>

<p>That said, later in this episode I refer to a certain step I take as
“feeling stupid” (around the 24:30 minute mark),
and a few minutes later I refer to a similar step as feeling sloppy. I don’t really
explain my thinking during the video, so I’d like to expand on it here.</p>

<p>The specific issue is around making a call to a Bundler test helper method called
<code>build_spec</code>. The method can receive an optional Array of version strings, and will
return an Array of Gem Specifications, one for each version string passed, which is
very handy. But if only a single version string is passed, the method still returns
the single Gem Specification in an Array. The method being tested only receives a
single spec, and so as I pass the results from <code>build_spec</code> along, I repeatedly
forget that fact and move myself along by selecting the <code>.first</code> from the result.</p>

<p>Perhaps that method could be renamed to <code>build_specs</code> to better express itself,
though that would be a large refactoring throughout the tests, or another option
would be to add a method <code>build_single_spec</code> either locally or alongside <code>build_spec</code>
among the test helpers.</p>

<p>In any case, again, I wish my language were more precise. I am
identifying a small
<a href="http://martinfowler.com/bliki/CodeSmell.html">code smell</a> with the naming of the
helper method, but “stupid” and “sloppy” are potentially derogatory for something that
is a normal thing to happen in code.</p>

<p>One last point that I’ll discuss more in the next episode has to do with mocks. A large
part of this episode is spent flailing, trying to get a real Specification instance
to do what I need. There’s a secondary, behind-the-scenes reason for not using a mock
here, but the larger point is I tend to not favor mocks when I can get a related
class to do its own job. (Of course, I’m saying this and doing this while borrowing 
from a nearby test that I wrote, that has a hand-rolled mock in it). I’ll 
offer some more explanation next time, but for now I’ll acknowledge that this is an
issue I’m aware of here and I’d love to hear what you think! Shoot an email to the link below 
or hit up @realcodez on twitter.</p>

<p><em>If you aren’t a subscriber, you’ll see the trailer below with an option to rent the specific episode.</em></p>

<iframe src="https://player.vimeo.com/video/195393394" width="640" height="360" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>

<hr width="20%" />

<h3 id="links">Links</h3>

<ul>
  <li><a href="https://github.com/bundler/bundler/pull/5105">Bundler PR #5105</a> (<a href="https://github.com/bundler/bundler/issues/4979">original issue #4979</a>)</li>
  <li><a href="http://martinfowler.com/bliki/CodeSmell.html">Code Smell</a></li>
  <li><a href="http://www.justinweiss.com/articles/4-simple-memoization-patterns-in-ruby-and-one-gem/">Ruby Memoization Patterns</a></li>
  <li><a href="http://www.jamesshore.com/Blog/Red-Green-Refactor.html">Red-Green-Refactor</a></li>
</ul>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

    <div class="wrapper">

        <div><br/></div>

        <div style="display: flex;">
            <div>
                <p style="width: 200px;">RealCodez</p>
            </div>

            <div style="flex-grow: 1;">
                <div>
                    <!-- Begin MailChimp Signup Form -->
                    <div id="mc_embed_signup">
                        <form action="//realcodez.us14.list-manage.com/subscribe/post?u=c66810b544f40d35e0a36f5ea&amp;id=dac6cc6555"
                              method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form"
                              class="validate"
                              target="_blank" novalidate>
                            <div id="mc_embed_signup_scroll">
                                <!-- <div class="indicates-required"><span class="asterisk">*</span> indicates required</div> -->
                                <div class="mc-field-group" style="text-align: right">
                                    <label for="mce-EMAIL">Subscribe to the RealCodez mailing list: </label>
                                    <input type="email" value="" placeholder="email address" name="EMAIL"
                                           class="required email" id="mce-EMAIL">
                                    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"
                                           class="button">
                                </div>
                                <div id="mce-responses" class="clear">
                                    <div class="response" id="mce-error-response" style="display:none"></div>
                                    <div class="response" id="mce-success-response" style="display:none"></div>
                                </div>
                                <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                                <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text"
                                                                                                          name="b_c66810b544f40d35e0a36f5ea_dac6cc6555"
                                                                                                          tabindex="-1"
                                                                                                          value="">
                                </div>
                                <div class="clear"></div>
                            </div>
                        </form>
                    </div>
                    <!--End mc_embed_signup-->
                </div>
            </div>
        </div>

        <div class="footer-col-wrapper">
            <div class="footer-col  footer-col-1">
                <ul class="contact-list">
                    <li><a href="/2016/11/22/welcome-to-realcodez.html">About RealCodez</a></li>
                    <li><a href="mailto:realcodez@clabs.org">realcodez@clabs.org</a></li>
                </ul>
            </div>

            <div class="footer-col  footer-col-2">
                <ul class="social-media-list">
                    

                    
                    <li>
                        <a href="https://twitter.com/realcodez">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>
                            <span class="username">realcodez</span>
                        </a>
                    </li>
                    
                </ul>
            </div>

            <div class="footer-col  footer-col-3">
                <p class="text">Where real world development meets real world failure and frustration for your entertainucation.
</p>
            </div>
        </div>
    </div>

</footer>


  </body>

</html>
